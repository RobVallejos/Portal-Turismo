let comercios = {
   comercios: [
      {
         nombre: "Supermercado Atomo",
         detalle: "Supermercado 24 hrs",
         direccion: "Coronel Mercau 1166, D5881 Merlo, San Luis",
         coordenadas: [-32.33847916071844, -65.01406774630965],
         horario: "Lunes a Domingo de 8 a 14",
         telefono: "1123457895",
         img1: "https://lh5.googleusercontent.com/p/AF1QipNdNKZnYfWNwHBPT3QsoBArPdYtqYHdImxNsQAk=w408-h307-k-no",
         supermercado: true,
         perfumeria: true,
         otros: false,
         avisos: [
            {
               nombre: "Leche",
               detalle: "Leche don satur",
               img1: "https://previews.123rf.com/images/yuwnis07/yuwnis072211/yuwnis07221100038/194959154-leche-de-caricatura-animada-plana-en-ilustraci%C3%B3n-de-caja-de-papel-grande-bebidas-ricas-en-calcio.jpg",
               img2: "https://us.123rf.com/450wm/kahovsky/kahovsky2008/kahovsky200800097/154187168-linda-leche-divertida-feliz-icono-de-ilustraci%C3%B3n-de-personaje-kawaii-de-dibujos-animados-de-l%C3%ADnea.jpg?ver=6",
               img3: "https://dibujos-paracolorear.de/wp-content/uploads/2020/05/imagenes-leches.png",
               supermercado: true,
               perfumeria: false,
               otros: false,
               servicio: false,
               producto: true,
               // hace referencia a Restricciones (servicio) o caracteristicas (producto)
               infoAdicional: "Leche 1L",
               precio: "sin precio asignado",
               estado: "vigente",

            },
            {
               nombre: "Leche",
               detalle: "Leche VI",
               img1: "https://us.123rf.com/450wm/kahovsky/kahovsky2008/kahovsky200800097/154187168-linda-leche-divertida-feliz-icono-de-ilustraci%C3%B3n-de-personaje-kawaii-de-dibujos-animados-de-l%C3%ADnea.jpg?ver=6",
               img2: "https://previews.123rf.com/images/yuwnis07/yuwnis072211/yuwnis07221100038/194959154-leche-de-caricatura-animada-plana-en-ilustraci%C3%B3n-de-caja-de-papel-grande-bebidas-ricas-en-calcio.jpg",
               img3: "https://dibujos-paracolorear.de/wp-content/uploads/2020/05/imagenes-leches.png",
               supermercado: true,
               perfumeria: false,
               otros: false,
               servicio: false,
               producto: true,
               // hace referencia a Restricciones (servicio) o caracteristicas (producto)
               infoAdicional: "Leche 1L",
               precio: "$1.200",
               estado: "vigente",

            },
            {
               nombre: "Set Perfume Carolina Herrera Bad Boy + Shower Gel Original",
               detalle: "Perfume masculino",
               img1: "https://images.fravega.com/f500/639e7ffb6c76050b742483a061bf41f3.jpg",
               img2: "https://d3ugyf2ht6aenh.cloudfront.net/stores/001/188/259/products/ch-bad-boy-11-c2c362bcd4534b831716225029380496-240-0.jpg",
               img3: "https://f.fcdn.app/imgs/3a9323/electroventas.com.uy/elecuy/0528/original/catalogo/VIE65189703VIE651897032/1500-1500/set-perfume-carolina-herrera-bad-boy-edt-50ml-shower-gel-original-set-perfume-carolina-herrera-bad-boy-edt-50ml-shower-gel-original.jpg",
               supermercado: false,
               perfumeria: true,
               otros: false,
               servicio: false,
               producto: true,
               categoria: "perfumeria",
               // hace referencia a Restricciones (servicio) o caracteristicas (producto)
               infoAdicional: "50ml",
               precio: "$100.000",
               estado: "vigente",

            }
         ]
      },
      {
         nombre: "Carniceria",
         detalle: "Carniceria Familiar",
         direccion: "Avenida Nte. 1440, D5881 Merlo, San Luis",
         coordenadas: [-32.336086722050766, -65.01425911745416],
         horario: "Lunes a Domingo de 8 a 14",
         telefono: "1123457895",
         img1: "https://cloudfront-us-east-1.images.arcpublishing.com/radiomitre/WOSQKJ7TP5ERZH4RP3LP6UZ5KE.jpg",
         supermercado: false,
         perfumeria: false,
         otros: true,
         avisos: [
            {
               nombre: "asado",
               detalle: "asado finito",
               img1: "https://thumbs.dreamstime.com/z/asado-crudo-8478920.jpg",
               img2: "https://www.elcucodigital.com/wp-content/uploads/2023/08/carne1.jpg",
               img3: "https://previews.123rf.com/images/greggr/greggr1609/greggr160901880/62831888-tradicional-suram%C3%A9rica-cocina-costillas-asado-de-carne-crudos-gran-filete-bistec-en-gran-cl%C3%A1sica.jpg",
               supermercado: false,
               perfumeria: false,
               otros: true,
               servicio: false,
               producto: true,
               // hace referencia a Restricciones (servicio) o caracteristicas (producto)
               infoAdicional: "5kg de asado",
               precio: "$5.000",
               estado: "vigente",

            }
         ]
      },
      {
         nombre: "Salto del Tabaquillo",
         detalle: "Centro de actividades el Salto",
         direccion: "San Luis",
         coordenadas: [-32.34519807906826, -64.94462049586063],
         horario: "Lunes a Domingo de 8 a 20hrs",
         telefono: "1123457895",
         img1: "https://lh5.googleusercontent.com/p/AF1QipPpOnWSevt10RrzsxVb_-jwHntngjofHeZeN2kT=w408-h544-k-no",
         supermercado: false,
         perfumeria: false,
         otros: true,
         avisos: [
            {
               nombre: "Salto de la cascada",
               detalle: "asado finito",
               img1: "https://www.eluniversal.com.mx/resizer/E_Ed6dwBDEU_0ZFIJK9F3LlbWdk=/1100x666/cloudfront-us-east-1.images.arcpublishing.com/eluniversal/HPCJSKD5YVC5TPVAGX3LR2PHNY.jpg",
               img2: "https://i.pinimg.com/originals/a6/2d/c5/a62dc52302f90004794b7bd5670930b1.jpg",
               img3: "https://www.elsoldeparral.com.mx/incoming/n20v3n-cascada-foto-mariano-rubio2.jpg/ALTERNATES/LANDSCAPE_1140/CASCADA%20FOTO%20MARIANO%20RUBIO2.jpg",
               supermercado: false,
               perfumeria: false,
               otros: true,
               servicio: true,
               producto: false,
               // hace referencia a Restricciones (servicio) o caracteristicas (producto)
               infoAdicional: "Apto para mayores de 12 años",
               precio: "$5.000",
               estado: "vigente",

            },
            {
               nombre: "Tirolesa",
               detalle: "Salto en tirolesa",
               img1: "https://bpprivilegeclub.com/blog/wp-content/uploads/2020/08/Zip-Line-Anamuya.jpg",
               img2: "https://media-cdn.tripadvisor.com/media/photo-s/0f/8c/0e/9d/salto-em-dupla.jpg",
               img3: "https://previews.123rf.com/images/rh2010/rh20101507/rh2010150700305/43573748-mujer-joven-en-el-usar-ocasional-con-paseos-casco-rojo-en-una-tirolesa-en-las-monta%C3%B1as-especie.jpg",
               supermercado: false,
               perfumeria: false,
               otros: true,
               servicio: true,
               producto: false,
               // hace referencia a Restricciones (servicio) o caracteristicas (producto)
               infoAdicional: "Apto para mayores de 12 años",
               precio: "$7.000",
               estado: "vigente",

            }
         ]
      }
      ,
      {
         nombre: "Panaderia La Florida",
         detalle: "pan, tortas y desayunos",
         direccion: "Merlo, San Luis",
         coordenadas: [-32.335379596175216, -65.01576113994042],
         horario: "Lunes a Domingo de 8 a 14",
         telefono: "1123457895",
         img1: "https://lh5.googleusercontent.com/p/AF1QipOTRFfvT8Uft-T0jPZJx37BFfORccTkOyRTV1FG=w426-h240-k-no",
         supermercado: false,
         perfumeria: false,
         otros: true,
         avisos: [
            {
               nombre: "Pan",
               detalle: "1kg",
               img1: "https://a.storyblok.com/f/120479/6d797da1b3/mitos-pan-1.jpg",
               img2: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQhoi4UTi0Tg_5SmQ8KmYK6dVMG0yrwtWx5Xg&usqp=CAU",
               img3: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRQ_JczQk0fVsXDR6dokT6s2m8Apy_8f2MHgw&usqp=CAU",
               supermercado: false,
               perfumeria: false,
               otros: true,
               servicio: false,
               producto: true,
               // hace referencia a Restricciones (servicio) o caracteristicas (producto)
               infoAdicional: "Pan Frances",
               precio: "$1.100",
               estado: "vigente",

            },
            {
               nombre: "Delivery Desayuno para 2 Personas",
               detalle: "1kg de pan, 1 torta de ricota y 2 jugos exprimidos",
               img1: "https://fanbag.com.ar/imagenes/thumb/78/17578_tentacionesacasa-600x460_95_600x460_f.jpg",
               img2: "https://cocina-casera.com/wp-content/uploads/2018/04/desayuno-ingl%C3%A9s-2.jpg",
               img3: "https://thumbs.dreamstime.com/z/desayuno-en-cama-con-te-quiero-el-texto-una-nota-la-taza-de-caf%C3%A9-jugo-macarrones-subi%C3%B3-flor-bandeja-madera-rom%C3%A1ntico-133817600.jpg",
               supermercado: false,
               perfumeria: false,
               otros: true,
               servicio: true,
               producto: false,
               // hace referencia a Restricciones (servicio) o caracteristicas (producto)
               infoAdicional: "Servicio a domicilio",
               precio: "$3.500",
               estado: "vigente",

            },
            {
               nombre: "Torta artesanal",
               detalle: "Torta artesanal de 5kg",
               img1: "https://www.mendoza.gov.ar/wp-content/uploads/sites/49/2019/10/DOLCE-LUC%C3%8DA-17.jpg",
               img2: "https://i.ytimg.com/vi/U9yd38hXago/maxresdefault.jpg",
               img3: "https://www.lanacion.com.ar/resizer/v2/torta-HB4RI5VI3ZHRNPIEZGN3MM3LME.png?auth=0b0329a1dc91105d6e45458a9fff828231da8018489bd4d922f4e117e68fd567&width=420&height=280&quality=70&smart=true",
               supermercado: false,
               perfumeria: false,
               otros: true,
               servicio: false,
               producto: true,
               // hace referencia a Restricciones (servicio) o caracteristicas (producto)
               infoAdicional: "Torta a eleccion",
               precio: "$2.500",
               estado: "vigente",

            }
         ]
      }
      ,
      {
         nombre: "Lo de Villa Regionales",
         detalle: "Chocolates, alfajores, perfumes y vinos",
         direccion: "74, San Luis, Chaco",
         coordenadas: [-32.33648281345723, -64.9841003323629],
         horario: "Lunes a Domingo de 8 a 21hrs",
         telefono: "1123457895",
         img1: "https://lh5.googleusercontent.com/p/AF1QipPruF1V1pFNLPi_9zwKyMPzPcSBCtapO4FzEQD3=w408-h725-k-no",
         supermercado: false,
         perfumeria: false,
         otros: true,
         avisos: [
            {
               nombre: "Chocolates Reginales",
               detalle: "1kg",
               img1: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQa7fxhMHzL9bdAWGAmon-nsQ92EGC7UTBmRsU0Uqe28NDhNndXwqKc6qHBtkqGlp0ezi4&usqp=CAU",
               img2: "https://1.bp.blogspot.com/_j5Jgz8c3qv4/TKDlUhJehEI/AAAAAAAAAHI/G3FRpx_Y9SY/s1600/chocococococ.jpg",
               img3: "https://c8.alamy.com/compes/eekk85/chocolate-artesanal-con-algunos-de-los-ingredientes-que-se-utilizan-en-estos-chocolates-eekk85.jpg",
               supermercado: false,
               perfumeria: false,
               otros: true,
               servicio: false,
               producto: true,
               // hace referencia a Restricciones (servicio) o caracteristicas (producto)
               infoAdicional: "Chocolate",
               precio: "$11.100",
               estado: "vigente",

            },
            {
               nombre: "Perfume Regional El Limpio",
               detalle: "Varias fragancias de 40ml",
               img1: "https://thisisyung.com/wp-content/uploads/2023/09/rs-OJAR_EDP_100ml_3.jpg.webp",
               img2: "https://diariolaopinion.com.ar/download/multimedia.normal.ab831a1fafe5d9a4.50657266756d65735f6e6f726d616c2e77656270.webp",
               img3: "https://www.inbodas.com/wp-content/uploads/2022/04/blog-bodas-perfumes-11.jpg",
               supermercado: false,
               perfumeria: true,
               otros: false,
               servicio: false,
               producto: true,
               // hace referencia a Restricciones (servicio) o caracteristicas (producto)
               infoAdicional: "Perfume Regional 40ml",
               precio: "$30.500",
               estado: "vigente",

            },
            {
               nombre: "alfajores  artesanal",
               detalle: "caja de 12 alfajores",
               img1: "https://almacenfamily.com/productos/7798136470011-3332-6019c540d52be.jpg",
               img2: "https://dulceres.com.ar/wp-content/uploads/2020/02/DSC0019-scaled-e1581172576923-1024x493.jpg",
               img3: "https://blog.winesofargentina.com/wp-content/uploads/2022/04/alfajores-argentinos-Image-2022-04-06-at-1.07.07-PM-1.jpeg-1024x691.jpg",
               supermercado: false,
               perfumeria: false,
               otros: true,
               servicio: false,
               producto: true,
               // hace referencia a Restricciones (servicio) o caracteristicas (producto)
               infoAdicional: "Torta a eleccion",
               precio: "$2.500",
               estado: "vigente",

            }
         ]
      }
   ]
}



//////////////////////////////////MAPA//////////////////////////////



var map = L.map('map').setView([-32.346975285600216, -65.00391276013097], 14);




var comercioIcon = L.icon({
   iconUrl: 'img/comercioIcono.png',
   iconSize: [38, 45],
   iconAnchor: [22, 30],
   popupAnchor: [-3, -10]
});


//llena el mapa con los comercios que corresponden a la busqueda
function llenarMapa(comerciosACompletar) {

   //console.log(comerciosACompletar);

   contenedorDeComercios.innerHTML = "";
   añadirComerciosAlDOM(comerciosACompletar);


   // Elimina todos los markers existentes en el mapa
   map.eachLayer((layer) => {
      if (layer instanceof L.Marker) {
         map.removeLayer(layer);
      }
   });
   // creo los nuevos markers
   comerciosACompletar.forEach((comercio) => {
      L.marker(comercio.coordenadas, { icon: comercioIcon }).addTo(map).bindPopup("<b>" + comercio.nombre + "</b><br>" + comercio.direccion + "</b><br>Horario: " + comercio.horario);
   });
}


L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
   maxZoom: 20,
   attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
}).addTo(map);



/////////////////////////////////////////////////////Logica//////////////////////////////////////////////





const contenerDeProcutos = document.getElementById('cuerpoAvisos');
const contenedorDeComercios = document.getElementById('cuerpoComercios');
var filtroSupermercadoIsChecked = true;
var filtroPerfumeriaIsChecked = true;
var filtroOtrosIsChecked = true;


// actualiza en las variables de JS segun el estado del check "supermercado"

var filtroSupermercado = document.querySelector("input[name=Supermercado]");
filtroSupermercado.addEventListener('click', function () {
   if (filtroSupermercado.checked) {
      filtroSupermercadoIsChecked = true;
      return filtroSupermercadoIsChecked;
   }
   else {
      filtroSupermercadoIsChecked = false;
      return filtroSupermercadoIsChecked;
   }
}
);
// actualiza en las variables de JS segun el estado del check "perfumeria"

var filtroPerfumeria = document.querySelector("input[name=Perfumeria]");
filtroPerfumeria.addEventListener('click', function () {
   if (filtroPerfumeria.checked) {
      filtroPerfumeriaIsChecked = true;
      return filtroPerfumeriaIsChecked;
   }
   else {
      filtroPerfumeriaIsChecked = false;
      return filtroPerfumeriaIsChecked;
   }
});
// actualiza en las variables de JS segun el estado del check "otros"
var filtroOtros = document.querySelector("input[name=Otros]");
filtroOtros.addEventListener('click', function () {
   if (filtroOtros.checked) {
      filtroOtrosIsChecked = true;
      return filtroOtrosIsChecked;
   }
   else {
      filtroOtrosIsChecked = false;
      return filtroOtrosIsChecked;
   }
});


let comercio = comercios.comercios


const buscador = document.getElementById("buscador");
const inputBusqueda = document.getElementById("inputBusqueda");

// Toma el Input del Buscador del front, y filtra los avisos con ese nombre
buscador.addEventListener("click", function () {

   contenerDeProcutos.innerHTML = "";
   var produc = [];
   var comercios = [];
   var valor = inputBusqueda.value;
   valor = valor.toLowerCase();

   comercio.forEach((producto) => {


      producto.avisos.forEach((aviso) => {

         let nombre = aviso.nombre
         nombre = nombre.toLowerCase();

         if (nombre.includes(valor)) {
            produc.push(aviso)
            comercios.push(producto);
         }

      })
   })
   llenarMapa(comercios)
   añadirAvisosAlDOM(produc);



})

///////////////////////////////////////////


// Todas las casuisticas de filtrados de avisos, segun los check del Front
function filtrarAvisos() {

   var produc = [];
   var comerciosParaElmapa = [];
   var cont = 0;


   comercio.forEach((comercios) => {

      console.log(comercios)
      cont = cont + 1;

      console.log(cont)


      comercios.avisos.forEach((aviso) => {

         switch (true) {
            case filtroSupermercadoIsChecked && filtroPerfumeriaIsChecked && filtroOtrosIsChecked:
               if (aviso.supermercado || aviso.perfumeria || aviso.otros) {
                  produc.push(aviso);
                  if (!comerciosParaElmapa.includes(comercios)) {
                     comerciosParaElmapa.push(comercios);
                 }
               }
               break;

            case filtroSupermercadoIsChecked && filtroPerfumeriaIsChecked && !filtroOtrosIsChecked:
               if (aviso.supermercado || aviso.perfumeria) {
                  produc.push(aviso);
                  if (!comerciosParaElmapa.includes(comercios)) {
                     comerciosParaElmapa.push(comercios);
                 }
               }
               break;

            case filtroSupermercadoIsChecked && !filtroPerfumeriaIsChecked && filtroOtrosIsChecked:
               if (aviso.supermercado || aviso.otros) {
                  produc.push(aviso);
                  if (!comerciosParaElmapa.includes(comercios)) {
                     comerciosParaElmapa.push(comercios);
                 }
               }
               break;

            case filtroSupermercadoIsChecked && !filtroPerfumeriaIsChecked && !filtroOtrosIsChecked:
               if (aviso.supermercado) {
                  produc.push(aviso);
                  if (!comerciosParaElmapa.includes(comercios)) {
                     comerciosParaElmapa.push(comercios);
                 }
               }
               break;

            case !filtroSupermercadoIsChecked && filtroPerfumeriaIsChecked && filtroOtrosIsChecked:
               if (aviso.perfumeria || aviso.otros) {
                  produc.push(aviso);
                  if (!comerciosParaElmapa.includes(comercios)) {
                     comerciosParaElmapa.push(comercios);
                 }
               }
               break;

            case !filtroSupermercadoIsChecked && filtroPerfumeriaIsChecked && !filtroOtrosIsChecked:
               if (aviso.perfumeria) {
                  produc.push(aviso);
                  if (!comerciosParaElmapa.includes(comercios)) {
                     comerciosParaElmapa.push(comercios);
                 }
               }
               break;

            case !filtroSupermercadoIsChecked && !filtroPerfumeriaIsChecked && filtroOtrosIsChecked:
               if (aviso.otros) {
                  produc.push(aviso);
                  if (!comerciosParaElmapa.includes(comercios)) {
                     comerciosParaElmapa.push(comercios);
                 }
               }
               break;
         }

      })

   })

   llenarMapa(comerciosParaElmapa);
   añadirAvisosAlDOM(produc);
}


const botonActualizar = document.getElementById("actualizar-filtros");
const verTodosLosAvisos = document.getElementById("ver-todo");

// muestra todos los avisos con el boton "Ver todos los productos"
verTodosLosAvisos.addEventListener('click', function () {

   contenerDeProcutos.innerHTML = "";
   var comerciosParaElmapa = [];

   comercio.forEach((comercio) => {
      añadirAvisosAlDOM(comercio.avisos);
      comerciosParaElmapa.push(comercio);
   })
   llenarMapa(comercio);

})


// Filtra los avisos segun los check
function mostrarAvisosFiltrados() {
   contenerDeProcutos.innerHTML = "";
   filtrarAvisos();
}

botonActualizar.addEventListener('click', mostrarAvisosFiltrados)

// Crea en el HTML la lista con los avisos a mostrar, segun el listado de comercios que le brinden

function añadirAvisosAlDOM(avisos) {


   avisos.forEach((aviso) => {

      const div = document.createElement(`div`)
      const image = document.createElement("img")
      image.src = aviso.img1
      div.innerHTML = `<div class="card mb-3" style="max-width: 540px;">
       
               <div class="row g-0">
                 <div class="col-md-4">
                 <img src="${aviso.img1}" class="img-fluid rounded-start" alt="..."> 
                 </div>
                 <div class="col-md-8">
                   <div class="card-body">
                     <h5 class="card-title">${aviso.nombre}</h5>
                     <p class="card-text">descripcion : ${aviso.detalle}</p>
                     <p class="card-text">precio : ${aviso.precio}</p>
                     <p class="card-text">precio : ${aviso.infoAdicional}</p>
                   </div>
                 </div>
               </div>
             </div>`

      contenerDeProcutos.append(div);

   })


}




// Crea en el HTML la lista con comercios a mostrar, segun el listado de comercios que le brinden
function añadirComerciosAlDOM(comercios) {
   comercios.forEach((comercio) => {

      const div = document.createElement(`div`)
      const image = document.createElement("img")
      image.src = comercio.img1
      div.innerHTML = `<div class="card mb-3" style="max-width: 540px;">
       
               <div class="row g-0">
                 <div class="col-md-4">
                 <img src="${comercio.img1}" class="img-fluid rounded-start" alt="..."> 
                 </div>
                 <div class="col-md-8">
                   <div class="card-body">
                     <h5 class="card-title">${comercio.nombre}</h5>
                     <p class="card-text">descripcion : ${comercio.detalle}</p>
                     <p class="card-text">Direccion : ${comercio.direccion}</p>
                     <p class="card-text">Telefono : ${comercio.telefono}</p>
                     <p class="card-text">Tiene articulos de Supermercado? : ${comercio.supermercado}</p>
                     <p class="card-text">Tiene articulos de Perfumeria? : ${comercio.perfumeria}</p>
                     <p class="card-text">Tiene articulo de Otras categorias?: ${comercio.otros}</p>
                   </div>
                 </div>
               </div>
             </div>`

      contenedorDeComercios.append(div);

   })
}

